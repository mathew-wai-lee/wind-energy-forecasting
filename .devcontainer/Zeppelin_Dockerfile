FROM apache/zeppelin:0.12.0

ENV SPARK_VERSION=3.5.6
ENV HADOOP_VERSION=3

USER root
RUN apt-get update && apt-get install -y curl unzip wget grep sed vim tzdata && apt-get clean

USER root
RUN apt-get update && apt-get install -y openjdk-17-jdk && apt-get clean
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
ENV PATH="$JAVA_HOME/bin:$PATH"

# auto upload zeppelin interpreter lib
RUN rm -rf /zeppelin

RUN rm -rf /spark
# RUN wget https://www-us.apache.org/dist/spark/spark-${SPARK_VERSION}/spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz
RUN wget https://downloads.apache.org/spark/spark-${SPARK_VERSION}/spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz
RUN tar zxvf spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz
RUN mv spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION} /opt/spark
RUN rm spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz

# # Install Python, pip, Jupyter, PySpark, pandas, matplotlib, seaborn, Quarto
# RUN apt-get update && apt-get install -y python3 python3-pip && apt-get clean
# RUN pip3 install --upgrade pip
# RUN pip3 install jupyterlab pyspark pandas matplotlib seaborn quarto

# # Expose Jupyter port
# EXPOSE 8888



# docker build -t zep_spark .devcontainer --platform linux/amd64

# docker run -u $(id -u) -p 8080:8080 --rm \
#   -v ./notebooks:/notebooks \
#   -v $(pwd)/data:/data \
#   --platform linux/amd64 \
#   -e SPARK_HOME=/opt/spark \
#   -e ZEPPELIN_NOTEBOOK_DIR='/notebooks' \
#   -e ZEPPELIN_NOTEBOOK_STORAGE=org.apache.zeppelin.notebook.repo.VFSNotebookRepo \
#   --name zeppelin zep_spark:latest
